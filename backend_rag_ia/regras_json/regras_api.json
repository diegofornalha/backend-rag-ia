{
  "metadata_global": {
    "language": "pt-BR",
    "tipo": "regra",
    "fonte": "REGRAS_API.md",
    "data_criacao": "2024-12-30T16:03:01.501571",
    "categorias": [
      "regras"
    ],
    "id": "c29a9874cfffbcddf355acbbb23a5619"
  },
  "document": {
    "content": "Princípios de Harmonia e Coerência:\n> **Regra Fundamental**: Todo o sistema deve manter perfeita ordem e harmonia, garantindo que cada componente se comunique adequadamente dentro de seu contexto.\n\n1. Coerência Contextual:\n- Cada endpoint deve ter um propósito claro e bem definido\n- Metadados devem ser consistentes com o contexto do documento\n- Embeddings devem refletir precisamente o conteúdo semântico\n- Respostas da API devem ser coerentes com as requisições\n\n2. Harmonia entre Componentes:\n- Documentos ↔️ Embeddings: Sincronização perfeita\n- Metadados ↔️ Conteúdo: Alinhamento semântico\n- Buscas ↔️ Resultados: Relevância contextual\n- Requisições ↔️ Respostas: Consistência lógica\n\n3. Integridade Relacional:\n- Manter vínculos corretos entre documentos e embeddings\n- Garantir consistência entre metadados globais e específicos\n- Preservar relações entre documentos similares\n- Assegurar rastreabilidade das operações\n\nAvisos Recorrentes que Requerem Autorização:\n- **Alterações Críticas**:\n- Modificações em endpoints existentes\n- Atualizações de schema do banco\n- Alterações nas regras de embedding\n- Mudanças nos parâmetros de busca\n- **Problemas de Performance**:\n- Alto consumo de memória durante sincronização\n- Lentidão nas respostas dos endpoints\n- Falhas recorrentes na geração de embeddings\n- Degradação no tempo de resposta das buscas\n- **Questões de Integridade**:\n- Documentos sem embeddings por mais de 24h\n- Inconsistências entre documentos e embeddings\n- Falhas na deduplicação automática\n- Erros de sincronização persistentes\n\nSolicitação de Feedback:\n- **Quando Solicitar**:\n- Resultados inesperados nas buscas semânticas\n- Comportamento anômalo na deduplicação\n- Falhas não previstas na documentação\n- Divergências entre comportamento esperado e real\n- **Como Reportar**:\n- Descrever o problema detalhadamente\n- Fornecer logs relevantes\n- Sugerir possíveis soluções\n- Indicar impacto no sistema\n- **Acompanhamento**:\n- Registrar decisões tomadas\n- Documentar soluções aplicadas\n- Monitorar efetividade das correções\n- Atualizar documentação quando necessário\n\n1. Registro de Otimizações:\n- **Sincronização e Deduplicação**:\n- Implementado sistema inteligente de hash para detecção de duplicatas\n- Remoção automática mantendo documentos originais\n- Preservação de embeddings dos documentos principais\n- Limpeza cascata de embeddings órfãos\n- **Monitoramento de Eficiência**:\n- Rastreamento de tempo de processamento\n- Contagem de documentos antes/depois\n- Taxa de sucesso nas operações\n- Métricas de performance\n\n2. Histórico de Melhorias:\n- **Última Atualização**: 29/12/2023\n- Implementada sincronização inteligente de documentos\n- Adicionada detecção de conteúdo duplicado\n- Otimizado processo de remoção em cascata\n- Melhorada visualização de estatísticas\n\n3. Processo de Evolução:\n- **Identificação de Padrões**:\n- Análise de problemas recorrentes\n- Detecção de gargalos de performance\n- Avaliação de feedback dos usuários\n- Monitoramento de falhas\n- **Implementação de Soluções**:\n- Desenvolvimento de correções\n- Testes de eficácia\n- Documentação das mudanças\n- Atualização das regras\n\n4. Ciclo de Melhoria Contínua:\n1. **Observar**: Monitorar comportamento do sistema\n2. **Analisar**: Identificar pontos de melhoria\n3. **Planejar**: Desenvolver soluções\n4. **Implementar**: Aplicar melhorias\n5. **Documentar**: Atualizar regras e documentação\n6. **Verificar**: Validar eficácia das mudanças\n\nObservações Importantes:\n> **Nota sobre Notificações**: Este projeto atualmente é mantido individualmente, sem necessidade de notificações de equipe. Caso futuramente seja expandido para uma equipe, implementar sistema de notificações para:\n>\n> - Alterações em endpoints críticos\n> - Atualizações de documentação\n> - Mudanças em regras de negócio\n> - Alterações de schema\n\nPOST /api/v1/documents/:\nAdiciona novos documentos ao índice.\n**Request:**\n```json\n{\n\"documents\": [\n{\n\"content\": \"Texto do documento\",\n\"metadata\": {\n\"type\": \"profile\",\n\"tags\": [\"biografia\", \"profissional\"]\n}\n}\n]\n}\n```\n**Response:**\n```json\n{\n\"message\": \"Processando 1 documentos em background\"\n}\n```\n\nDELETE /api/v1/documents/{document_id}:\nRemove um documento específico e seu embedding.\n**Response:**\n```json\n{\n\"message\": \"Documento removido com sucesso\",\n\"document_id\": \"123\"\n}\n```\n\nPUT /api/v1/documents/{document_id}:\nAtualiza um documento existente.\n**Request:**\n```json\n{\n\"content\": \"Novo texto do documento\",\n\"metadata\": {\n\"type\": \"profile\",\n\"tags\": [\"biografia\", \"profissional\"]\n}\n}\n```\n**Response:**\n```json\n{\n\"message\": \"Documento atualizado com sucesso\",\n\"document_id\": \"123\"\n}\n```\n\nPOST /api/v1/search/:\nRealiza busca semântica nos documentos.\n**Request:**\n```json\n{\n\"query\": \"string\",\n\"k\": 4,\n\"filters\": {\n\"type\": \"profile\",\n\"tecnologias\": [\"Python\"],\n\"content_types\": [\"biografia\"]\n}\n}\n```\n**Response:**\n```json\n[\n{\n\"content\": \"Texto encontrado\",\n\"metadata\": {\n\"type\": \"profile\",\n\"timestamp\": \"2024-03-21T10:30:00\",\n\"pessoas\": [\"Diego Fornalha\"],\n\"tecnologias\": [\"Python\"],\n\"content_types\": [\"biografia\"]\n},\n\"embedding_id\": 1\n}\n]\n```\n\nGET /api/v1/documents/{document_id}:\nRetorna um documento específico por ID.\n**Response:**\n```json\n{\n\"id\": \"123\",\n\"content\": \"Texto do documento\",\n\"metadata\": {\n\"type\": \"profile\",\n\"tags\": [\"biografia\", \"profissional\"]\n},\n\"embedding_id\": 1,\n\"created_at\": \"2024-03-21T10:30:00\"\n}\n```\n\nGET /api/v1/health:\nVerifica o status da API.\n**Response:**\n```json\n{\n\"status\": \"healthy\",\n\"message\": \"API está funcionando normalmente\",\n\"documents_count\": 3\n}\n```\n\nGET /api/v1/documents/count:\nRetorna o número total de documentos armazenados.\n**Response:**\n```json\n{\n\"count\": 3\n}\n```\n\nPOST /api/v1/embeddings/sync:\nSincroniza embeddings para documentos que não os possuem.\n**Response:**\n```json\n{\n\"message\": \"Sincronização iniciada\",\n\"documents_to_process\": 5\n}\n```\n\nGET /api/v1/embeddings/status:\nVerifica o status da sincronização de embeddings.\n**Response:**\n```json\n{\n\"total_documents\": 10,\n\"documents_with_embeddings\": 8,\n\"documents_without_embeddings\": 2,\n\"last_sync\": \"2024-03-21T10:30:00\"\n}\n```\n\nDeduplicação Inteligente:\n- Threshold de similaridade: 0.8\n- Análise de conteúdo para evitar redundância\n- Consolidação de informações similares\n\nProcessamento de Metadados:\n- Extração automática de entidades\n- Categorização de conteúdo\n- Normalização de nomes e termos\n- Indexação otimizada para busca rápida\n\nBusca Avançada:\n- Busca semântica com Supabase+pgvector\n- Filtragem por metadados\n- Combinação de múltiplos critérios\n- Ordenação por relevância\n\nExemplo de Uso:\n```python\n\nBusca por tipo específico:\ndocs = vector_store.filter_by_metadata({\n\"content_types\": \"tutorial\"\n})\n\nBusca combinada:\ndocs = vector_store.filter_by_metadata({\n\"pessoas\": \"Diego Fornalha\",\n\"tecnologias\": \"Python\",\n\"content_types\": \"projeto\"\n})\n```\n\nNotas de Implementação:\n1. **Indexação**:\n- Uso de pgvector para busca semântica\n- Índice invertido para metadados\n- Batch processing para melhor performance\n2. **Otimizações**:\n- Processamento em background\n- Deduplicação automática\n- Caching de embeddings\n- Normalização de entidades\n3. **Persistência**:\n- Salvamento automático no Supabase\n- Backup de metadados\n- Formato JSON otimizado\n4. **Segurança**:\n- Validação de entrada\n- Sanitização de dados\n- Logging de operações",
    "metadata": {
      "type": "regra",
      "title": "REGRAS_API",
      "autor": "sistema",
      "formato_original": "markdown",
      "tags": [
        "documentação",
        "regras"
      ],
      "versao": "1.0"
    }
  }
}